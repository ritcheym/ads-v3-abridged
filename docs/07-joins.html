<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>7&nbsp; Data Relations – Applied Data Skills - Abridged</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./08-tidy.html" rel="next">
<link href="./06-ai.html" rel="prev">
<link href="./images/logos/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-6NP3MF25W3"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-6NP3MF25W3', { 'anonymize_ip': true});
</script><link rel="stylesheet" href="include/psyteachr.css">
<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/style.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./07-joins.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Relations</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Applied Data Skills - Abridged</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/psyteachr/ads-v3/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Intro to R and RStudio</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-reports.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Reports with R Markdown</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-viz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Visualisation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Summaries</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-formative.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Practice Report</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-ai.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Coding with AI</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-joins.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Relations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-tidy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data Tidying</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-wrangle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Data Wrangling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-custom.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Customising Visualisations &amp; Reports</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-refs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-license.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">License/Citation</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-installing-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Installing R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-updating-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Updating R, RStudio, and packages</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-symbols.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Symbols</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-conventions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Conventions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-teams.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Using Teams</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-debugging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Debugging</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-import.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">Data Import</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-datatypes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Data Types</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-dates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">I</span>&nbsp; <span class="chapter-title">Dates and Times</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-styling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">J</span>&nbsp; <span class="chapter-title">Styling Plots</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./app-webpage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">K</span>&nbsp; <span class="chapter-title">Webpages</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<p><a href="https://doi.org/10.5281/zenodo.6365077"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.6365077.svg" alt="DOI"></a></p>
</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#sec-ilo-joins" id="toc-sec-ilo-joins" class="nav-link active" data-scroll-target="#sec-ilo-joins">Intended Learning Outcomes</a></li>
  <li><a href="#functions-joins" id="toc-functions-joins" class="nav-link" data-scroll-target="#functions-joins"><span class="header-section-number">7.1</span> Functions used</a></li>
  <li><a href="#sec-walkthrough-joins" id="toc-sec-walkthrough-joins" class="nav-link" data-scroll-target="#sec-walkthrough-joins">Walkthrough video</a></li>
  <li><a href="#sec-setup-joins" id="toc-sec-setup-joins" class="nav-link" data-scroll-target="#sec-setup-joins"><span class="header-section-number">7.2</span> Set-up</a></li>
  <li><a href="#sec-joins-data" id="toc-sec-joins-data" class="nav-link" data-scroll-target="#sec-joins-data"><span class="header-section-number">7.3</span> Loading data</a></li>
  <li>
<a href="#mutating-joins" id="toc-mutating-joins" class="nav-link" data-scroll-target="#mutating-joins"><span class="header-section-number">7.4</span> Mutating Joins</a>
  <ul class="collapse">
<li><a href="#sec-left_join" id="toc-sec-left_join" class="nav-link" data-scroll-target="#sec-left_join"><span class="header-section-number">7.4.1</span> left_join()</a></li>
  <li><a href="#sec-right_join" id="toc-sec-right_join" class="nav-link" data-scroll-target="#sec-right_join"><span class="header-section-number">7.4.2</span> right_join()</a></li>
  <li><a href="#sec-inner_join" id="toc-sec-inner_join" class="nav-link" data-scroll-target="#sec-inner_join"><span class="header-section-number">7.4.3</span> inner_join()</a></li>
  <li><a href="#sec-full_join" id="toc-sec-full_join" class="nav-link" data-scroll-target="#sec-full_join"><span class="header-section-number">7.4.4</span> full_join()</a></li>
  </ul>
</li>
  <li>
<a href="#filtering-joins" id="toc-filtering-joins" class="nav-link" data-scroll-target="#filtering-joins"><span class="header-section-number">7.5</span> Filtering Joins</a>
  <ul class="collapse">
<li><a href="#sec-semi_join" id="toc-sec-semi_join" class="nav-link" data-scroll-target="#sec-semi_join"><span class="header-section-number">7.5.1</span> semi_join()</a></li>
  <li><a href="#sec-anti_join" id="toc-sec-anti_join" class="nav-link" data-scroll-target="#sec-anti_join"><span class="header-section-number">7.5.2</span> anti_join()</a></li>
  </ul>
</li>
  <li><a href="#multiple-joins" id="toc-multiple-joins" class="nav-link" data-scroll-target="#multiple-joins"><span class="header-section-number">7.6</span> Multiple joins</a></li>
  <li>
<a href="#binding-joins" id="toc-binding-joins" class="nav-link" data-scroll-target="#binding-joins"><span class="header-section-number">7.7</span> Binding Joins</a>
  <ul class="collapse">
<li><a href="#sec-bind_rows" id="toc-sec-bind_rows" class="nav-link" data-scroll-target="#sec-bind_rows"><span class="header-section-number">7.7.1</span> bind_rows()</a></li>
  <li><a href="#sec-bind_cols" id="toc-sec-bind_cols" class="nav-link" data-scroll-target="#sec-bind_cols"><span class="header-section-number">7.7.2</span> bind_cols()</a></li>
  <li><a href="#importing-multiple-files" id="toc-importing-multiple-files" class="nav-link" data-scroll-target="#importing-multiple-files"><span class="header-section-number">7.7.3</span> Importing multiple files</a></li>
  </ul>
</li>
  <li>
<a href="#set-operations" id="toc-set-operations" class="nav-link" data-scroll-target="#set-operations"><span class="header-section-number">7.8</span> Set Operations</a>
  <ul class="collapse">
<li><a href="#sec-intersect" id="toc-sec-intersect" class="nav-link" data-scroll-target="#sec-intersect"><span class="header-section-number">7.8.1</span> intersect()</a></li>
  <li><a href="#sec-union" id="toc-sec-union" class="nav-link" data-scroll-target="#sec-union"><span class="header-section-number">7.8.2</span> union()</a></li>
  <li><a href="#sec-setdiff" id="toc-sec-setdiff" class="nav-link" data-scroll-target="#sec-setdiff"><span class="header-section-number">7.8.3</span> setdiff()</a></li>
  </ul>
</li>
  <li><a href="#conflicting-variable-types" id="toc-conflicting-variable-types" class="nav-link" data-scroll-target="#conflicting-variable-types"><span class="header-section-number">7.9</span> Conflicting variable types</a></li>
  <li>
<a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">7.10</span> Exercises</a>
  <ul class="collapse">
<li><a href="#grade-data" id="toc-grade-data" class="nav-link" data-scroll-target="#grade-data"><span class="header-section-number">7.10.1</span> Grade data</a></li>
  <li><a href="#matching-the-variable-types" id="toc-matching-the-variable-types" class="nav-link" data-scroll-target="#matching-the-variable-types"><span class="header-section-number">7.10.2</span> Matching the variable types</a></li>
  <li><a href="#complete-records" id="toc-complete-records" class="nav-link" data-scroll-target="#complete-records"><span class="header-section-number">7.10.3</span> Complete records</a></li>
  <li><a href="#missing-data" id="toc-missing-data" class="nav-link" data-scroll-target="#missing-data"><span class="header-section-number">7.10.4</span> Missing data</a></li>
  <li><a href="#share-on-teams" id="toc-share-on-teams" class="nav-link" data-scroll-target="#share-on-teams"><span class="header-section-number">7.10.5</span> Share on Teams</a></li>
  </ul>
</li>
  <li><a href="#sec-glossary-joins" id="toc-sec-glossary-joins" class="nav-link" data-scroll-target="#sec-glossary-joins"><span class="header-section-number">7.11</span> Glossary</a></li>
  <li><a href="#sec-resources-joins" id="toc-sec-resources-joins" class="nav-link" data-scroll-target="#sec-resources-joins"><span class="header-section-number">7.12</span> Further resources</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/psyteachr/ads-v3/edit/master/07-joins.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/psyteachr/ads-v3/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/psyteachr/ads-v3/blob/master/07-joins.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-joins" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Relations</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="sec-ilo-joins" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="sec-ilo-joins">Intended Learning Outcomes</h2>
<ul>
<li>Be able to match related data across multiple tables</li>
<li>Be able to combine data from multiple files</li>
</ul></section><section id="functions-joins" class="level2" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="functions-joins">
<span class="header-section-number">7.1</span> Functions used</h2>
<ul>
<li>built-in (you can always use these without loading any packages)
<ul>
<li>base:: <code><a href="https://rdrr.io/r/base/library.html">library()</a></code>, <code><a href="https://rdrr.io/r/base/files2.html">dir.create()</a></code>, <code><a href="https://rdrr.io/r/base/list.files.html">list.files()</a></code>, <code><a href="https://rdrr.io/r/base/numeric.html">as.numeric()</a></code>, <code><a href="https://rdrr.io/r/base/factor.html">as.factor()</a></code>, <code><a href="https://rdrr.io/r/base/character.html">as.character()</a></code>, <code><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame()</a></code>
</li>
</ul>
</li>
<li>tidyverse (you can use all these with <code><a href="https://tidyverse.tidyverse.org">library(tidyverse)</a></code>)
<ul>
<li>readr:: <code>write_csv()</code>, <code>read_csv()</code>
</li>
<li>dplyr:: <code>left_join()</code>, <code>right_join()</code>, <code>inner_join()</code>, <code>full_join()</code>, <code>semi_join()</code>, <code>anti_join()</code>, <code>bind_rows()</code>, <code>bind_cols()</code>, <code><a href="https://rdrr.io/r/base/sets.html">intersect()</a></code>, <code><a href="https://rdrr.io/r/base/sets.html">union()</a></code>, <code><a href="https://rdrr.io/r/base/sets.html">setdiff()</a></code>, <code>mutate()</code>
</li>
<li>tibble:: <code>tibble()</code>, <code>as_tibble()</code>
</li>
<li>purrr:: <code>map_df()</code>
</li>
<li>stringr:: <code>str_replace_all()</code>
</li>
</ul>
</li>
</ul></section><section id="sec-walkthrough-joins" class="level2 unnumbered"><h2 class="unnumbered anchored" data-anchor-id="sec-walkthrough-joins">Walkthrough video</h2>
<p>There is a walkthrough video of this chapter available via <a href="https://echo360.org.uk/media/519bb538-58b3-4710-85df-d71c56001a5d/public">Echo360.</a> Please note that there may have been minor edits to the book since the video was recorded. Where there are differences, the book should always take precedence.</p>
</section><section id="sec-setup-joins" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="sec-setup-joins">
<span class="header-section-number">7.2</span> Set-up</h2>
<p>First, create a new project for the work we’ll do in this chapter named <code class="path">07-relations</code>. Second, open and save a new R Markdown document named <code>relations.Rmd</code>, delete the welcome text, and load the required packages for this chapter.</p>
<div class="cell" data-layout-align="center" data-verbatim="r setup, include=FALSE">
<div class="verbatim">
<pre class="sourceCode r code-with-copy"><code class="sourceCode R">```{r setup, include=FALSE}</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)     <span class="co"># includes readr &amp; tibble</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="sourceCode r code-with-copy"><code class="sourceCode R">```</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
</div>
</div>
<p>Download the <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-transformation.pdf">Data transformation cheatsheet</a>.</p>
</section><section id="sec-joins-data" class="level2" data-number="7.3"><h2 data-number="7.3" class="anchored" data-anchor-id="sec-joins-data">
<span class="header-section-number">7.3</span> Loading data</h2>
<p>The data you want to report on or visualise are often in more than one file (or more than one tab of an excel file or googlesheet). You might need to join up a table of customer information with a table of orders, or combine the monthly social media reports across several months.</p>
<p>For this demo, rather than loading in data, we’ll create two small data tables from scratch using the <code>tibble()</code> function.</p>
<p><code>customers</code> has id, city and postcode for five customers 1-5.</p>
<ul>
<li>
<code>1:5</code> will fill the variable <code>id</code> with all integers between 1 and 5.</li>
<li>
<code>city</code> and <code>code</code> both use the <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> function to enter multiple strings. Note that each entry is contained within its own quotation marks, apart from missing data, which is recorded as <code>NA</code>.</li>
<li>When entering data like this, it’s important that the order of each variable matches up. So number 1 will correspond to “Port Ellen” and “PA42 7DU”.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>customers <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="at">city =</span> <span class="fu">c</span>(<span class="st">"Port Ellen"</span>, <span class="st">"Dufftown"</span>, <span class="cn">NA</span>, <span class="st">"Aberlour"</span>, <span class="st">"Tobermory"</span>),</span>
<span id="cb2-4"><a href="#cb2-4"></a>  <span class="at">postcode =</span> <span class="fu">c</span>(<span class="st">"PA42 7DU"</span>, <span class="st">"AB55 4DH"</span>, <span class="cn">NA</span>, <span class="st">"AB38 7RY"</span>, <span class="st">"PA75 6NR"</span>)</span>
<span id="cb2-5"><a href="#cb2-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<table class="caption-top table">
<caption>Demo customers table.</caption>
<thead><tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: left;">city</th>
<th style="text-align: left;">postcode</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Port Ellen</td>
<td style="text-align: left;">PA42 7DU</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Dufftown</td>
<td style="text-align: left;">AB55 4DH</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Aberlour</td>
<td style="text-align: left;">AB38 7RY</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Tobermory</td>
<td style="text-align: left;">PA75 6NR</td>
</tr>
</tbody>
</table>
<p><code>orders</code> has customer id and the number of items ordered. Some customers from the previous table have no orders, some have more than one order, and some are not in the customer table.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>orders <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="at">id =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">7</span>),</span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="at">items =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">18</span>, <span class="dv">21</span>, <span class="dv">23</span>, <span class="dv">9</span>, <span class="dv">11</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">3</span>)</span>
<span id="cb3-4"><a href="#cb3-4"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<table class="caption-top table">
<caption>Demo orders table.</caption>
<thead><tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">items</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">3</td>
</tr>
</tbody>
</table></section><section id="mutating-joins" class="level2" data-number="7.4"><h2 data-number="7.4" class="anchored" data-anchor-id="mutating-joins">
<span class="header-section-number">7.4</span> Mutating Joins</h2>
<p><a href="https://psyteachr.github.io/glossary/m#mutating-joins" target="_blank" class="glossary" title="Joins that act like the dplyr::mutate() function in that they add new columns to one table based on values in another table.">Mutating joins</a> act like the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate()</a></code> function in that they add new columns to one table based on values in another table. (We’ll learn more about the <code>mutate()</code> function in <a href="08-tidy.html" class="quarto-xref"><span>Chapter 8</span></a>).)</p>
<p>All the mutating joins have this basic syntax:</p>
<p><code>****_join(x, y, by = NULL, suffix = c(".x", ".y"))</code></p>
<ul>
<li>
<code>x</code> = the first (left) table</li>
<li>
<code>y</code> = the second (right) table</li>
<li>
<code>by</code> = what columns to match on. If you leave this blank, it will match on all columns with the same names in the two tables.</li>
<li>
<code>suffix</code> = if columns have the same name in the two tables, but you aren’t joining by them, they get a suffix to make them unambiguous. This defaults to “.x” and “.y”, but you can change it to something more meaningful.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can leave out the <code>by</code> argument if you’re matching on all of the columns with the same name, but it’s good practice to always specify it so your code is robust to changes in the loaded data.</p>
</div>
</div>
<section id="sec-left_join" class="level3" data-number="7.4.1"><h3 data-number="7.4.1" class="anchored" data-anchor-id="sec-left_join">
<span class="header-section-number">7.4.1</span> left_join()</h3>
<div class="join">
<p><img src="images/joins/left_join.png"></p>
</div>
<p>A <code>left_join</code> keeps all the data from the first (left) table and adds anything that matches from the second (right) table. If the right table has more than one match for a row in the left table, there will be more than one row in the joined table (see ids 4 and 5).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>left_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(customers, orders, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb4-2"><a href="#cb4-2"></a>left_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: left;">city</th>
<th style="text-align: left;">postcode</th>
<th style="text-align: right;">items</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Port Ellen</td>
<td style="text-align: left;">PA42 7DU</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Dufftown</td>
<td style="text-align: left;">AB55 4DH</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Aberlour</td>
<td style="text-align: left;">AB38 7RY</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Aberlour</td>
<td style="text-align: left;">AB38 7RY</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Tobermory</td>
<td style="text-align: left;">PA75 6NR</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Tobermory</td>
<td style="text-align: left;">PA75 6NR</td>
<td style="text-align: right;">11</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="join">
<p><img src="images/joins/left_join_rev.png"></p>
</div>
<p>The order you specify the tables matters, in the below code we have reversed the order and so the result is all rows from the <code>orders</code> table joined to any matching rows from the <code>customers</code> table.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>left2_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(orders, customers, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a>left2_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">items</th>
<th style="text-align: left;">city</th>
<th style="text-align: left;">postcode</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">Dufftown</td>
<td style="text-align: left;">AB55 4DH</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">18</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">21</td>
<td style="text-align: left;">Aberlour</td>
<td style="text-align: left;">AB38 7RY</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">23</td>
<td style="text-align: left;">Aberlour</td>
<td style="text-align: left;">AB38 7RY</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">Tobermory</td>
<td style="text-align: left;">PA75 6NR</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">11</td>
<td style="text-align: left;">Tobermory</td>
<td style="text-align: left;">PA75 6NR</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">11</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">12</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="sec-right_join" class="level3" data-number="7.4.2"><h3 data-number="7.4.2" class="anchored" data-anchor-id="sec-right_join">
<span class="header-section-number">7.4.2</span> right_join()</h3>
<div class="join">
<p><img src="images/joins/right_join.png"></p>
</div>
<p>A <code>right_join</code> keeps all the data from the second (right) table and joins anything that matches from the first (left) table.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>right_data <span class="ot">&lt;-</span> <span class="fu">right_join</span>(customers, orders, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb6-2"><a href="#cb6-2"></a>right_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: left;">city</th>
<th style="text-align: left;">postcode</th>
<th style="text-align: right;">items</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Dufftown</td>
<td style="text-align: left;">AB55 4DH</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Aberlour</td>
<td style="text-align: left;">AB38 7RY</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Aberlour</td>
<td style="text-align: left;">AB38 7RY</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Tobermory</td>
<td style="text-align: left;">PA75 6NR</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Tobermory</td>
<td style="text-align: left;">PA75 6NR</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This table has the same information as <code>left_join(orders, customers, by = "id")</code>, but the columns are in a different order (left table, then right table).</p>
</div>
</div>
</section><section id="sec-inner_join" class="level3" data-number="7.4.3"><h3 data-number="7.4.3" class="anchored" data-anchor-id="sec-inner_join">
<span class="header-section-number">7.4.3</span> inner_join()</h3>
<div class="join">
<p><img src="images/joins/inner_join.png"></p>
</div>
<p>An <code>inner_join</code> returns all the rows that have a match in both tables. Changing the order of the tables will change the order of the columns, but not which rows are kept.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>inner_data <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(customers, orders, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a>inner_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: left;">city</th>
<th style="text-align: left;">postcode</th>
<th style="text-align: right;">items</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Dufftown</td>
<td style="text-align: left;">AB55 4DH</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Aberlour</td>
<td style="text-align: left;">AB38 7RY</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Aberlour</td>
<td style="text-align: left;">AB38 7RY</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Tobermory</td>
<td style="text-align: left;">PA75 6NR</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Tobermory</td>
<td style="text-align: left;">PA75 6NR</td>
<td style="text-align: right;">11</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="sec-full_join" class="level3" data-number="7.4.4"><h3 data-number="7.4.4" class="anchored" data-anchor-id="sec-full_join">
<span class="header-section-number">7.4.4</span> full_join()</h3>
<div class="join">
<p><img src="images/joins/full_join.png"></p>
</div>
<p>A <code>full_join</code> lets you join up rows in two tables while keeping all of the information from both tables. If a row doesn’t have a match in the other table, the other table’s column values are set to <code>NA</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>full_data <span class="ot">&lt;-</span> <span class="fu">full_join</span>(customers, orders, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a>full_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: left;">city</th>
<th style="text-align: left;">postcode</th>
<th style="text-align: right;">items</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Port Ellen</td>
<td style="text-align: left;">PA42 7DU</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Dufftown</td>
<td style="text-align: left;">AB55 4DH</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Aberlour</td>
<td style="text-align: left;">AB38 7RY</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Aberlour</td>
<td style="text-align: left;">AB38 7RY</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Tobermory</td>
<td style="text-align: left;">PA75 6NR</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Tobermory</td>
<td style="text-align: left;">PA75 6NR</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="even">
<td style="text-align: right;">7</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section></section><section id="filtering-joins" class="level2" data-number="7.5"><h2 data-number="7.5" class="anchored" data-anchor-id="filtering-joins">
<span class="header-section-number">7.5</span> Filtering Joins</h2>
<p><a href="https://psyteachr.github.io/glossary/f#filtering-joins" target="_blank" class="glossary" title="Joins that act like the dplyr::filter() function in that they remove rows from the data in one table based on the values in another table.">Filtering joins</a> act like the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code> function in that they keep and remove rows from the data in one table based on the values in another table. The result of a filtering join will only contain rows from the left table and have the same number or fewer rows than the left table. We’ll learn more about the <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> function in <a href="09-wrangle.html" class="quarto-xref"><span>Chapter 9</span></a>.</p>
<section id="sec-semi_join" class="level3" data-number="7.5.1"><h3 data-number="7.5.1" class="anchored" data-anchor-id="sec-semi_join">
<span class="header-section-number">7.5.1</span> semi_join()</h3>
<div class="join">
<p><img src="images/joins/semi_join.png"></p>
</div>
<p>A <code>semi_join</code> returns all rows from the left table where there are matching values in the right table, keeping just columns from the left table.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>semi_data <span class="ot">&lt;-</span> <span class="fu">semi_join</span>(customers, orders, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a>semi_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: left;">city</th>
<th style="text-align: left;">postcode</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Dufftown</td>
<td style="text-align: left;">AB55 4DH</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Aberlour</td>
<td style="text-align: left;">AB38 7RY</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Tobermory</td>
<td style="text-align: left;">PA75 6NR</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Unlike an inner join, a semi join will never duplicate the rows in the left table if there is more than one matching row in the right table.</p>
</div>
</div>
<div class="join">
<p><img src="images/joins/semi_join_rev.png"></p>
</div>
<p>Order matters in a semi join.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>semi2_data <span class="ot">&lt;-</span> <span class="fu">semi_join</span>(orders, customers, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb10-2"><a href="#cb10-2"></a>semi2_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">items</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">11</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="sec-anti_join" class="level3" data-number="7.5.2"><h3 data-number="7.5.2" class="anchored" data-anchor-id="sec-anti_join">
<span class="header-section-number">7.5.2</span> anti_join()</h3>
<div class="join">
<p><img src="images/joins/anti_join.png"></p>
</div>
<p>An <code>anti_join</code> return all rows from the left table where there are <em>not</em> matching values in the right table, keeping just columns from the left table.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>anti_data <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(customers, orders, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a>anti_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: left;">city</th>
<th style="text-align: left;">postcode</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Port Ellen</td>
<td style="text-align: left;">PA42 7DU</td>
</tr></tbody>
</table>
</div>
</div>
</div>
<div class="join">
<p><img src="images/joins/anti_join_rev.png"></p>
</div>
<p>Order matters in an anti join.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>anti2_data <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(orders, customers, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb12-2"><a href="#cb12-2"></a>anti2_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">items</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">12</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section></section><section id="multiple-joins" class="level2" data-number="7.6"><h2 data-number="7.6" class="anchored" data-anchor-id="multiple-joins">
<span class="header-section-number">7.6</span> Multiple joins</h2>
<p>The <code>****_join()</code> functions are all <strong>two-table verbs</strong>, that is, you can only join together two tables at a time. However, you may often need to join together multiple tables. To do so, you simply need to add on additional joins. You can do this by creating an intermediate object or more efficiently by using a pipe.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># create a table of overall customer satisfaction scores</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>satisfaction <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="at">satisfaction =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb13-5"><a href="#cb13-5"></a>)</span>
<span id="cb13-6"><a href="#cb13-6"></a></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="co"># perform the initial join</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>join_1 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(customers, orders, <span class="at">by =</span> <span class="st">"id"</span>)</span>
<span id="cb13-9"><a href="#cb13-9"></a></span>
<span id="cb13-10"><a href="#cb13-10"></a><span class="co"># perform the second join on the new object</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>join_2 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(join_1, satisfaction, </span>
<span id="cb13-12"><a href="#cb13-12"></a>                    <span class="at">by =</span> <span class="st">"id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># more efficient method using the pipe</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>pipe_join <span class="ot">&lt;-</span> customers <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">left_join</span>(orders, <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">left_join</span>(satisfaction, <span class="at">by =</span> <span class="st">"id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>At every stage of any analysis you should <strong>check your output</strong> to ensure that what you created is what you intended to create, but this is particularly true of joins. You should be familiar enough with your data through routine checks using functions like <code>glimpse()</code>, <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code>, and <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> to have a rough idea of what the join should result in. At the very least, you should know whether the joined object should result in more or fewer variables and observations.</p>
<p>If you have a multi-line join like in the above piped example, build up the code and check the output at each stage.</p>
</div>
</div>
</section><section id="binding-joins" class="level2" data-number="7.7"><h2 data-number="7.7" class="anchored" data-anchor-id="binding-joins">
<span class="header-section-number">7.7</span> Binding Joins</h2>
<p><a href="https://psyteachr.github.io/glossary/b#binding-joins" target="_blank" class="glossary" title="Joins that bind one table to another by adding their rows or columns together.">Binding joins</a> bind one table to another by adding their rows or columns together.</p>
<section id="sec-bind_rows" class="level3" data-number="7.7.1"><h3 data-number="7.7.1" class="anchored" data-anchor-id="sec-bind_rows">
<span class="header-section-number">7.7.1</span> bind_rows()</h3>
<p>You can combine the rows of two tables with <code>bind_rows</code>.</p>
<p>Here we’ll add customer data for customers 6-9 and bind that to the original customer table.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>new_customers <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="at">id =</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">9</span>,</span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="at">city =</span> <span class="fu">c</span>(<span class="st">"Falkirk"</span>, <span class="st">"Ardbeg"</span>, <span class="st">"Doogal"</span>, <span class="st">"Kirkwall"</span>),</span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="at">postcode =</span> <span class="fu">c</span>(<span class="st">"FK1 4RS"</span>, <span class="st">"PA42 7EA"</span>, <span class="st">"G81 4SJ"</span>, <span class="st">"KW15 1SE"</span>)</span>
<span id="cb15-5"><a href="#cb15-5"></a>)</span>
<span id="cb15-6"><a href="#cb15-6"></a></span>
<span id="cb15-7"><a href="#cb15-7"></a>bindr_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(customers, new_customers)</span>
<span id="cb15-8"><a href="#cb15-8"></a>bindr_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: left;">city</th>
<th style="text-align: left;">postcode</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Port Ellen</td>
<td style="text-align: left;">PA42 7DU</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Dufftown</td>
<td style="text-align: left;">AB55 4DH</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Aberlour</td>
<td style="text-align: left;">AB38 7RY</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Tobermory</td>
<td style="text-align: left;">PA75 6NR</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">Falkirk</td>
<td style="text-align: left;">FK1 4RS</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: left;">Ardbeg</td>
<td style="text-align: left;">PA42 7EA</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: left;">Doogal</td>
<td style="text-align: left;">G81 4SJ</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: left;">Kirkwall</td>
<td style="text-align: left;">KW15 1SE</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The columns just have to have the same names, they don’t have to be in the same order. Any columns that differ between the two tables will just have <code>NA</code> values for entries from the other table.</p>
<p>If a row is duplicated between the two tables (like id 5 below), the row will also be duplicated in the resulting table. If your tables have the exact same columns, you can use <code><a href="https://rdrr.io/r/base/sets.html">union()</a></code> (see <a href="#sec-union" class="quarto-xref"><span>Section 7.8.2</span></a>) to avoid duplicates.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>new_customers <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="at">id =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">9</span>,</span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="at">postcode =</span> <span class="fu">c</span>(<span class="st">"PA75 6NR"</span>, <span class="st">"FK1 4RS"</span>, <span class="st">"PA42 7EA"</span>, <span class="st">"G81 4SJ"</span>, <span class="st">"KW15 1SE"</span>),</span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="at">city =</span> <span class="fu">c</span>(<span class="st">"Tobermory"</span>, <span class="st">"Falkirk"</span>, <span class="st">"Ardbeg"</span>, <span class="st">"Doogal"</span>, <span class="st">"Kirkwall"</span>),</span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="at">new =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb16-6"><a href="#cb16-6"></a>)</span>
<span id="cb16-7"><a href="#cb16-7"></a></span>
<span id="cb16-8"><a href="#cb16-8"></a>bindr2_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(customers, new_customers)</span>
<span id="cb16-9"><a href="#cb16-9"></a>bindr2_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: left;">city</th>
<th style="text-align: left;">postcode</th>
<th style="text-align: right;">new</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Port Ellen</td>
<td style="text-align: left;">PA42 7DU</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Dufftown</td>
<td style="text-align: left;">AB55 4DH</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Aberlour</td>
<td style="text-align: left;">AB38 7RY</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Tobermory</td>
<td style="text-align: left;">PA75 6NR</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Tobermory</td>
<td style="text-align: left;">PA75 6NR</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: left;">Falkirk</td>
<td style="text-align: left;">FK1 4RS</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">7</td>
<td style="text-align: left;">Ardbeg</td>
<td style="text-align: left;">PA42 7EA</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: left;">Doogal</td>
<td style="text-align: left;">G81 4SJ</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: left;">Kirkwall</td>
<td style="text-align: left;">KW15 1SE</td>
<td style="text-align: right;">5</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="sec-bind_cols" class="level3" data-number="7.7.2"><h3 data-number="7.7.2" class="anchored" data-anchor-id="sec-bind_cols">
<span class="header-section-number">7.7.2</span> bind_cols()</h3>
<p>You can merge two tables with the same number of rows using <code>bind_cols</code>. This is only useful if the two tables have the same number of rows in the exact same order.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>new_info <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb17-2"><a href="#cb17-2"></a>  <span class="at">colour =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"orange"</span>, <span class="st">"yellow"</span>, <span class="st">"green"</span>, <span class="st">"blue"</span>)</span>
<span id="cb17-3"><a href="#cb17-3"></a>)</span>
<span id="cb17-4"><a href="#cb17-4"></a></span>
<span id="cb17-5"><a href="#cb17-5"></a>bindc_data <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(customers, new_info)</span>
<span id="cb17-6"><a href="#cb17-6"></a>bindc_data </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: left;">city</th>
<th style="text-align: left;">postcode</th>
<th style="text-align: left;">colour</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Port Ellen</td>
<td style="text-align: left;">PA42 7DU</td>
<td style="text-align: left;">red</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Dufftown</td>
<td style="text-align: left;">AB55 4DH</td>
<td style="text-align: left;">orange</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">yellow</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Aberlour</td>
<td style="text-align: left;">AB38 7RY</td>
<td style="text-align: left;">green</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Tobermory</td>
<td style="text-align: left;">PA75 6NR</td>
<td style="text-align: left;">blue</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The only advantage of <code>bind_cols()</code> over a mutating join is when the tables don’t have any IDs to join by and you have to rely solely on their order. Otherwise, you should use a mutating join (all four mutating joins result in the same output when all rows in each table have exactly one match in the other table).</p>
</div>
</div>
</section><section id="importing-multiple-files" class="level3" data-number="7.7.3"><h3 data-number="7.7.3" class="anchored" data-anchor-id="importing-multiple-files">
<span class="header-section-number">7.7.3</span> Importing multiple files</h3>
<p>If you need to import and bind a whole folder full of files that have the same structure, get a list of all the files you want to combine. It’s easiest if they’re all in the same directory, although you can use a pattern to select the files you want if they have a systematic naming structure.</p>
<p>First, save the two customer tables to CSV files. The <code><a href="https://rdrr.io/r/base/files2.html">dir.create()</a></code> function makes a folder called “data”. The <code>showWarnings = FALSE</code> argument means that you won’t get a warning if the folder already exists, it just won’t do anything.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># write our data to a new folder for the demo</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="fu">dir.create</span>(<span class="st">"data"</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="fu">write_csv</span>(<span class="at">x =</span> customers, <span class="at">file =</span> <span class="st">"data/customers1.csv"</span>)</span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="fu">write_csv</span>(<span class="at">x =</span> new_customers, <span class="at">file =</span> <span class="st">"data/customers2.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, retrieve a list of all file names in the data folder that contain the string “customers”</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="at">path =</span> <span class="st">"data"</span>, </span>
<span id="cb19-3"><a href="#cb19-3"></a>  <span class="at">pattern =</span> <span class="st">"customers"</span>, </span>
<span id="cb19-4"><a href="#cb19-4"></a>  <span class="at">full.names =</span> <span class="cn">TRUE</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>)</span>
<span id="cb19-6"><a href="#cb19-6"></a></span>
<span id="cb19-7"><a href="#cb19-7"></a>files</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/customers1.csv" "data/customers2.csv"</code></pre>
</div>
</div>
<p>Next, we’ll iterate over this list to read in the data from each file. Whilst this won’t be something we cover in detail in the core resources of this course, <a href="https://psyteachr.github.io/glossary/i#iteration" target="_blank" class="glossary" title="Repeating a process or function">iteration</a> is an important concept to know about. Iteration is where you perform the same task on multiple different inputs. As a general rule of thumb, if you find yourself copying and pasting the same thing more than twice, there’s a more efficient and less error-prone way to do it, although these functions do typically require a stronger grasp of programming.</p>
<p>The <pkg>purrr</pkg> package contains functions to help with iteration. <code><a href="https://purrr.tidyverse.org/reference/map_dfr.html">purrr::map_df()</a></code> maps a function to a list and returns a data frame (table) of the results.</p>
<ul>
<li>
<code>.x</code> is the list of file paths</li>
<li>
<code>.f</code> specifies the function to map to each of those file paths.</li>
<li>The resulting object <code>all_files</code> will be a data frame that combines all the files together, similar to if you had imported them separately and then used <code>bind_rows()</code>.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>all_files <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_df</span>(<span class="at">.x =</span> files, <span class="at">.f =</span> read_csv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If all of your data files have the <em>exact</em> same structure (i.e., the same number of columns with the same names), you can just use <code>read_csv()</code> and set the <code>file</code> argument to a vector of the file names. However, the pattern above is safer if you might have a file with an extra or missing column.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>files <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"data/customers1.csv"</span>, <span class="st">"data/customers1.csv"</span>)</span>
<span id="cb22-2"><a href="#cb22-2"></a>all_files <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(files)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section></section><section id="set-operations" class="level2" data-number="7.8"><h2 data-number="7.8" class="anchored" data-anchor-id="set-operations">
<span class="header-section-number">7.8</span> Set Operations</h2>
<p><a href="https://psyteachr.github.io/glossary/s#set-operations" target="_blank" class="glossary" title="Functions that compare two tables and return rows that match (intersect), are in either table (union), or are in one table but not the other (setdiff).">Set operations</a> compare two tables and return rows that match (intersect), are in either table (union), or are in one table but not the other (setdiff).</p>
<section id="sec-intersect" class="level3" data-number="7.8.1"><h3 data-number="7.8.1" class="anchored" data-anchor-id="sec-intersect">
<span class="header-section-number">7.8.1</span> intersect()</h3>
<p><code><a href="https://generics.r-lib.org/reference/setops.html">dplyr::intersect()</a></code> returns all rows in two tables that match exactly. The columns don’t have to be in the same order, but they have to have the same names.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>new_customers <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb23-2"><a href="#cb23-2"></a>  <span class="at">id =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">9</span>,</span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="at">postcode =</span> <span class="fu">c</span>(<span class="st">"PA75 6NR"</span>, <span class="st">"FK1 4RS"</span>, <span class="st">"PA42 7EA"</span>, <span class="st">"G81 4SJ"</span>, <span class="st">"KW15 1SE"</span>),</span>
<span id="cb23-4"><a href="#cb23-4"></a>  <span class="at">city =</span> <span class="fu">c</span>(<span class="st">"Tobermory"</span>, <span class="st">"Falkirk"</span>, <span class="st">"Ardbeg"</span>, <span class="st">"Doogal"</span>, <span class="st">"Kirkwall"</span>)</span>
<span id="cb23-5"><a href="#cb23-5"></a>)</span>
<span id="cb23-6"><a href="#cb23-6"></a></span>
<span id="cb23-7"><a href="#cb23-7"></a>intersect_data <span class="ot">&lt;-</span> <span class="fu">intersect</span>(customers, new_customers)</span>
<span id="cb23-8"><a href="#cb23-8"></a>intersect_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: left;">city</th>
<th style="text-align: left;">postcode</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Tobermory</td>
<td style="text-align: left;">PA75 6NR</td>
</tr></tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you’ve forgotten to load dplyr or the tidyverse, <a href="https://psyteachr.github.io/glossary/b#base-r" target="_blank" class="glossary" title="The set of R functions that come with a basic installation of R, before you add external packages.">base R</a> also has a <code><a href="https://rdrr.io/r/base/sets.html">base::intersect()</a></code> function that doesn’t work like <code><a href="https://generics.r-lib.org/reference/setops.html">dplyr::intersect()</a></code>. The error message can be confusing and looks something like this:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>base<span class="sc">::</span><span class="fu">intersect</span>(customers, new_customers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code><a href="https://rdrr.io/r/base/list.html">list()</a></code></pre>
</div>
</div>
</div>
</div>
</section><section id="sec-union" class="level3" data-number="7.8.2"><h3 data-number="7.8.2" class="anchored" data-anchor-id="sec-union">
<span class="header-section-number">7.8.2</span> union()</h3>
<p><code><a href="https://generics.r-lib.org/reference/setops.html">dplyr::union()</a></code> returns all the rows from both tables, removing duplicate rows, unlike <code>bind_rows()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>union_data <span class="ot">&lt;-</span> <span class="fu">union</span>(customers, new_customers)</span>
<span id="cb26-2"><a href="#cb26-2"></a>union_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: left;">city</th>
<th style="text-align: left;">postcode</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Port Ellen</td>
<td style="text-align: left;">PA42 7DU</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Dufftown</td>
<td style="text-align: left;">AB55 4DH</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Aberlour</td>
<td style="text-align: left;">AB38 7RY</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">Tobermory</td>
<td style="text-align: left;">PA75 6NR</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">Falkirk</td>
<td style="text-align: left;">FK1 4RS</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: left;">Ardbeg</td>
<td style="text-align: left;">PA42 7EA</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: left;">Doogal</td>
<td style="text-align: left;">G81 4SJ</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: left;">Kirkwall</td>
<td style="text-align: left;">KW15 1SE</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you’ve forgotten to load dplyr or the tidyverse, <a href="https://psyteachr.github.io/glossary/b#base-r" target="_blank" class="glossary" title="The set of R functions that come with a basic installation of R, before you add external packages.">base R</a> also has a <code><a href="https://rdrr.io/r/base/sets.html">base::union()</a></code> function. You usually won’t get an error message, but the output won’t be what you expect.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>base<span class="sc">::</span><span class="fu">union</span>(customers, new_customers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 1 2 3 4 5

[[2]]
[1] "Port Ellen" "Dufftown"   NA           "Aberlour"   "Tobermory" 

[[3]]
[1] "PA42 7DU" "AB55 4DH" NA         "AB38 7RY" "PA75 6NR"

[[4]]
[1] 5 6 7 8 9

[[5]]
[1] "PA75 6NR" "FK1 4RS"  "PA42 7EA" "G81 4SJ"  "KW15 1SE"

[[6]]
[1] "Tobermory" "Falkirk"   "Ardbeg"    "Doogal"    "Kirkwall" </code></pre>
</div>
</div>
</div>
</div>
</section><section id="sec-setdiff" class="level3" data-number="7.8.3"><h3 data-number="7.8.3" class="anchored" data-anchor-id="sec-setdiff">
<span class="header-section-number">7.8.3</span> setdiff()</h3>
<p><code><a href="https://generics.r-lib.org/reference/setops.html">dplyr::setdiff</a></code> returns rows that are in the first table, but not in the second table.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>setdiff_data <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(customers, new_customers)</span>
<span id="cb29-2"><a href="#cb29-2"></a>setdiff_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: left;">city</th>
<th style="text-align: left;">postcode</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">Port Ellen</td>
<td style="text-align: left;">PA42 7DU</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">Dufftown</td>
<td style="text-align: left;">AB55 4DH</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">Aberlour</td>
<td style="text-align: left;">AB38 7RY</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Order matters for <code>setdiff</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>setdiff2_data <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(new_customers, customers)</span>
<span id="cb30-2"><a href="#cb30-2"></a>setdiff2_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: left;">postcode</th>
<th style="text-align: left;">city</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: left;">FK1 4RS</td>
<td style="text-align: left;">Falkirk</td>
</tr>
<tr class="even">
<td style="text-align: right;">7</td>
<td style="text-align: left;">PA42 7EA</td>
<td style="text-align: left;">Ardbeg</td>
</tr>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: left;">G81 4SJ</td>
<td style="text-align: left;">Doogal</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: left;">KW15 1SE</td>
<td style="text-align: left;">Kirkwall</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you’ve forgotten to load dplyr or the tidyverse, <a href="https://psyteachr.github.io/glossary/b#base-r" target="_blank" class="glossary" title="The set of R functions that come with a basic installation of R, before you add external packages.">base R</a> also has a <code><a href="https://rdrr.io/r/base/sets.html">base::setdiff()</a></code> function. You usually won’t get an error message, but the output might not be what you expect because <code><a href="https://rdrr.io/r/base/sets.html">base::setdiff()</a></code> expects columns to be in the same order, so id 5 here registers as different between the two tables.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>base<span class="sc">::</span><span class="fu">setdiff</span>(customers, new_customers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$id
[1] 1 2 3 4 5

$city
[1] "Port Ellen" "Dufftown"   NA           "Aberlour"   "Tobermory" 

$postcode
[1] "PA42 7DU" "AB55 4DH" NA         "AB38 7RY" "PA75 6NR"</code></pre>
</div>
</div>
</div>
</div>
</section></section><section id="conflicting-variable-types" class="level2" data-number="7.9"><h2 data-number="7.9" class="anchored" data-anchor-id="conflicting-variable-types">
<span class="header-section-number">7.9</span> Conflicting variable types</h2>
<p>As we covered in <a href="app-import.html" class="quarto-xref"><span>Appendix G</span></a>, when you import or create data, R will do its best to set each column to an appropriate data type. However, sometimes it gets it wrong or sometimes there’s something in the way the data has been encoded in the original spreadsheet that causes the data type to be different than expected. When joining datasets by common columns, it’s important that not only are the variable names identical, but the data type of those variables is identical.</p>
<p>Let’s recreate our <code>new_customers</code> dataset but this time, we’ll specify that <code>id</code> is a <a href="https://psyteachr.github.io/glossary/c#character" target="_blank" class="glossary" title="A data type representing strings of text.">character</a> variable.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>new_customers2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb33-2"><a href="#cb33-2"></a>  <span class="at">id =</span> <span class="fu">as.character</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">9</span>),</span>
<span id="cb33-3"><a href="#cb33-3"></a>  <span class="at">postcode =</span> <span class="fu">c</span>(<span class="st">"PA75 6NR"</span>, <span class="st">"FK1 4RS"</span>, <span class="st">"PA42 7EA"</span>, <span class="st">"G81 4SJ"</span>, <span class="st">"KW15 1SE"</span>),</span>
<span id="cb33-4"><a href="#cb33-4"></a>  <span class="at">city =</span> <span class="fu">c</span>(<span class="st">"Tobermory"</span>, <span class="st">"Falkirk"</span>, <span class="st">"Ardbeg"</span>, <span class="st">"Doogal"</span>, <span class="st">"Kirkwall"</span>)</span>
<span id="cb33-5"><a href="#cb33-5"></a>)</span>
<span id="cb33-6"><a href="#cb33-6"></a><span class="fu">str</span>(new_customers2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [5 × 3] (S3: tbl_df/tbl/data.frame)
 $ id      : chr [1:5] "5" "6" "7" "8" ...
 $ postcode: chr [1:5] "PA75 6NR" "FK1 4RS" "PA42 7EA" "G81 4SJ" ...
 $ city    : chr [1:5] "Tobermory" "Falkirk" "Ardbeg" "Doogal" ...</code></pre>
</div>
</div>
<p>If you try to join this dataset to any of the other datasets where <code>id</code> is stored as a <a href="https://psyteachr.github.io/glossary/n#numeric" target="_blank" class="glossary" title="A data type representing a real decimal number or integer.">numeric</a> variable, it will produce an error.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="fu">inner_join</span>(customers, new_customers2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(id, city, postcode)`</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>Error in `inner_join()`:
! Can't join `x$id` with `y$id` due to incompatible types.
ℹ `x$id` is a &lt;integer&gt;.
ℹ `y$id` is a &lt;character&gt;.</code></pre>
</div>
</div>
<p>The same goes for <code>bind_rows()</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="fu">bind_rows</span>(customers, new_customers2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in `bind_rows()`:
! Can't combine `..1$id` &lt;integer&gt; and `..2$id` &lt;character&gt;.</code></pre>
</div>
</div>
<p>As alternative method to change variable types from what we showed you in <a href="app-import.html" class="quarto-xref"><span>Appendix G</span></a> is to use the <code>as.***</code> functions. If you type <code>as.</code> into a code chunk, you will see that there are a huge number of these functions for transforming variables and datasets to different types. Exactly which one you need will depend on the data you have, but a few commonly used ones are:</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/base/numeric.html">as.numeric()</a></code> - convert a variable to <a href="https://psyteachr.github.io/glossary/n#numeric" target="_blank" class="glossary" title="A data type representing a real decimal number or integer.">numeric</a>. Useful for when you have a variable of real numbers that have been encoded as character. Any values that can’t be turned into numbers (e.g., if you have the word “missing” in cells that you have no data for), will be returned as <code>NA</code>.</li>
<li>
<code><a href="https://rdrr.io/r/base/factor.html">as.factor()</a></code> - convert a variable to a <a href="https://psyteachr.github.io/glossary/f#factor" target="_blank" class="glossary" title="A data type where a specific set of values are stored with labels; An explanatory variable manipulated by the experimenter">factor</a>. You can set the factor levels and labels manually, or use the default order (alphabetical).</li>
<li>
<code><a href="https://rdrr.io/r/base/character.html">as.character()</a></code> - convert a variable to <a href="https://psyteachr.github.io/glossary/c#character" target="_blank" class="glossary" title="A data type representing strings of text.">character</a> data.</li>
<li>
<code>as_tibble()</code> and <code><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame()</a></code> - convert a list object (not a variable) to a tibble or a data frame (two different table formats). This isn’t actually relevant to what we’re discussing here, but it’s a useful one to be aware of because sometimes you’ll run into issues where you get an error that specifically requests your data is a tibble or data frame type and you can use this function to overwrite your object.</li>
</ul>
<p>To use these functions on a variable we can use <code>mutate()</code> to overwrite the variable with that variable as the new data type:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>new_customers2 <span class="ot">&lt;-</span> new_customers2 <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">as.numeric</span>(id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once you’ve done this, the joins will now work:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="fu">inner_join</span>(orders, new_customers2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(id)`</code></pre>
</div>
<div class="cell-output-display">
<div class="kable-table">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">items</th>
<th style="text-align: left;">postcode</th>
<th style="text-align: left;">city</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">PA75 6NR</td>
<td style="text-align: left;">Tobermory</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">11</td>
<td style="text-align: left;">PA75 6NR</td>
<td style="text-align: left;">Tobermory</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: right;">11</td>
<td style="text-align: left;">FK1 4RS</td>
<td style="text-align: left;">Falkirk</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">12</td>
<td style="text-align: left;">FK1 4RS</td>
<td style="text-align: left;">Falkirk</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">PA42 7EA</td>
<td style="text-align: left;">Ardbeg</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="exercises" class="level2" data-number="7.10"><h2 data-number="7.10" class="anchored" data-anchor-id="exercises">
<span class="header-section-number">7.10</span> Exercises</h2>
<p>There’s lots of different use cases for the <code>****_join()</code> functions. These exercises will allow you to practice different joins. If you have any examples of where joins might be helpful in your own work, please post them on Teams in the week 6 channel, as having many concrete examples can help distinguish between the different joins.</p>
<section id="grade-data" class="level3" data-number="7.10.1"><h3 data-number="7.10.1" class="anchored" data-anchor-id="grade-data">
<span class="header-section-number">7.10.1</span> Grade data</h3>
<p>The University of Glasgow’s Schedule A grading scheme uses a 22-point alphanumeric scale (there’s more information in your summative report <a href="https://sway.office.com/k0CnXGd6RjbVokkR" target="_blank">assessment information sheet</a>). Each alphanumeric grade (e.g., B2) has an underlying numeric Grade Point (e.g., 16).</p>
<p>Often when we’re working with student grades they are provided to us in only one of these forms, but we need to be able to go between the two. For example, we need the numeric form in order to be able to calculate descriptive statistics about the mean grade, but we need the alphanumeric form to release to student records.</p>
<ul>
<li><p>Download <a href="data/grade_data1.csv" download="">grade_data.csv</a>, <a href="data/grade_data2.csv" download="">grade_data2.csv</a> and <a href="data/scheduleA.csv" download="">scheduleA.csv</a> into your data folder.</p></li>
<li><p>Read in <code>scheduleA.csv</code> and save it to an object named <code>schedule</code>.</p></li>
<li><p>Read in <code>grade_data1.csv</code> and save it to an object named <code>grades1</code>.</p></li>
<li><p>Read in <code>grade_data2.csv</code> and save it to an object named <code>grades2</code>.</p></li>
</ul>
<div class="cell" data-layout-align="center" data-webex.hide="true">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>schedule <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/scheduleA.csv"</span>)</span>
<span id="cb43-2"><a href="#cb43-2"></a>grades1 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/grade_data1.csv"</span>) </span>
<span id="cb43-3"><a href="#cb43-3"></a>grades2 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/grade_data2.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section><section id="matching-the-variable-types" class="level3" data-number="7.10.2"><h3 data-number="7.10.2" class="anchored" data-anchor-id="matching-the-variable-types">
<span class="header-section-number">7.10.2</span> Matching the variable types</h3>
<p>At UofG, all students are given a GUID, a numeric ID number. However, that ID number is also then combined with the first letter from your surname to create your username that is used with your email address. For example, if your ID is 1234567 and your surname is Nordmann, your username would be 1234567n. From a data wrangling perspective this is very annoying because the numeric ID will be stored as numeric data, but the username will be stored as character because of the letter at the end. <code>grades1</code> has a numeric id whilst <code>grades2</code> has the additional letter. In order to join these datasets, we need to standardise the variables.</p>
<p>First, remove the letter character from <code>id</code> using the function <code><a href="https://stringr.tidyverse.org/reference/str_replace.html">stringr::str_replace_all()</a></code>, which replaces text that matches a pattern. Here, we’re using the pattern <code>"[a-z]"</code>, which matches all lowercase letters a through z, and replacing them with <code>""</code>. See the help for <code>?about_search_regex</code> for more info about how to set patterns (these can get really complex).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>grades1 <span class="ot">&lt;-</span> grades1 <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">str_replace_all</span>(</span>
<span id="cb44-3"><a href="#cb44-3"></a>    id, <span class="co"># the variable you want to search</span></span>
<span id="cb44-4"><a href="#cb44-4"></a>    <span class="at">pattern =</span> <span class="st">"[a-z]"</span>, <span class="co"># find all letters a-z</span></span>
<span id="cb44-5"><a href="#cb44-5"></a>    <span class="at">replacement =</span> <span class="st">""</span> <span class="co"># replace with nothing</span></span>
<span id="cb44-6"><a href="#cb44-6"></a>  ))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, transform the data type of <code>id</code> so that it matches the data type in <code>grades2</code>.</p>
<div class="cell" data-layout-align="center" data-webex.hide="true">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># check variable types</span></span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="fu">glimpse</span>(grades1)</span>
<span id="cb45-3"><a href="#cb45-3"></a><span class="fu">glimpse</span>(grades2) </span>
<span id="cb45-4"><a href="#cb45-4"></a></span>
<span id="cb45-5"><a href="#cb45-5"></a>grades1 <span class="ot">&lt;-</span> grades1 <span class="sc">%&gt;%</span></span>
<span id="cb45-6"><a href="#cb45-6"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">as.numeric</span>(id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section><section id="complete-records" class="level3" data-number="7.10.3"><h3 data-number="7.10.3" class="anchored" data-anchor-id="complete-records">
<span class="header-section-number">7.10.3</span> Complete records</h3>
<p>In this example, we want to join the grade data to schedule A so that each student with a grade has both the grade and the grade point. But we also want a complete record of all students on the course, so students with missing grades should still be included in the data.</p>
<ul>
<li>Join <code>grades1</code> and <code>scheduleA</code> and store this table in an object named <code>exam_all</code>.</li>
<li>Do the same for <code>grades2</code> and save it in <code>essay_all</code>.</li>
<li>Both <code>exam_all</code> and <code>essay_all</code> should have 100 observations of 4 variables.</li>
</ul>
<div class="webex-solution">
<button>
Hint
</button>
<p>You want to keep all of the data from <code>grade_data1</code> and <code>grade_data2</code>, but you only want the alphanumeric grades from <code>schedule</code> for the Grade Point values that exist in <code>grades</code>. E.g., if no-one was awarded an F1, your final dataset shouldn’t have that in it.</p>
</div>
<div class="cell" data-layout-align="center" data-webex.hide="true">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>exam_all <span class="ot">&lt;-</span> <span class="fu">left_join</span>(grades1, schedule, <span class="at">by =</span> <span class="st">"Points"</span>)</span>
<span id="cb46-2"><a href="#cb46-2"></a>essay_all <span class="ot">&lt;-</span> <span class="fu">left_join</span>(grades2, schedule, <span class="at">by =</span> <span class="st">"Points"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section><section id="missing-data" class="level3" data-number="7.10.4"><h3 data-number="7.10.4" class="anchored" data-anchor-id="missing-data">
<span class="header-section-number">7.10.4</span> Missing data</h3>
<p>Alternatively, you may wish to have a dataset that only contains data for students who submitted each assessment and have a grade. First, run <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> on both <code>exam_all</code> and <code>essay_all</code>.</p>
<ul>
<li>How many exam grades are missing? <input class="webex-solveme nospaces" size="2" data-answer="[&quot;17&quot;]">
</li>
<li>How many essay grades are missing? <input class="webex-solveme nospaces" size="2" data-answer="[&quot;23&quot;]">
</li>
</ul>
<p>Now, create an object <code>exam_grades</code> that joins together <code>grades1</code> and <code>schedule</code>, but this time the resulting object should only contain data from students who have a grade. Do the same but for <code>grades2</code> and store it in <code>essay_grades</code>.</p>
<p>Before you do this, given what you know about how many data points are missing in each data set:</p>
<ul>
<li>How many observations should <code>exam_grades</code> have? <input class="webex-solveme nospaces" size="2" data-answer="[&quot;83&quot;]">
</li>
<li>How many observations should <code>essay_grades</code> have? <input class="webex-solveme nospaces" size="2" data-answer="[&quot;77&quot;]">
</li>
</ul>
<div class="cell" data-layout-align="center" data-webex.hide="true">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>exam_grades <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(grades1, schedule, <span class="at">by =</span> <span class="st">"Points"</span>)</span>
<span id="cb47-2"><a href="#cb47-2"></a>essay_grades <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(grades2, schedule, <span class="at">by =</span> <span class="st">"Points"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="webex-solution">
<button>
Alternative solution
</button>
<p>It’s worth noting that in reality you wouldn’t actually go back to the raw data and do another join to get this dataset, you could just remove all the missing response by adding <code>%&gt;% drop_na()</code> to <code>exam_all</code> and <code>essay_all</code>. However, for the purposes of teaching joins, we’ll do it this slightly artificial way.</p>
</div>
<p>Now, create a dataset <code>completes</code> that joins the grades for students who have a grade for <strong>both</strong> the essay and the exam.</p>
<ul>
<li>Because both <code>exam_grades</code> and <code>essay_grades</code> have the variables <code>Assessment</code>, <code>Points</code> and <code>Grades</code> that are named the same, but have different data, you should amend the suffix so that the resulting variables are named <code>Points_exam</code> and <code>Points_essay</code> etc. You may need to consult the help documentation to see an example to figure this out.</li>
<li>Clean up the file with <code>select()</code> and only keep the variables <code>id</code>, <code>Grade_exam</code>, and <code>Grade_essay</code>
</li>
</ul>
<div class="cell" data-layout-align="center" data-webex.hide="true">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>completes <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(exam_grades, essay_grades, </span>
<span id="cb48-2"><a href="#cb48-2"></a>                        <span class="at">by =</span> <span class="st">"id"</span>, </span>
<span id="cb48-3"><a href="#cb48-3"></a>                        <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_exam"</span>, <span class="st">"_essay"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4"></a>  <span class="fu">select</span>(id, Grade_exam, Grade_essay)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<ul>
<li>How many students have a grade for both the exam and the essay? <input class="webex-solveme nospaces" size="2" data-answer="[&quot;62&quot;]">
</li>
</ul>
<p>Now create a dataset <code>no_essay</code> that contains students that have a grade for the exam, but not the essay.</p>
<div class="cell" data-layout-align="center" data-webex.hide="true">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a>no_essay <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(exam_grades, essay_grades, <span class="at">by =</span> <span class="st">"id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<ul>
<li>How many students have a grade for the exam but not the essay? <input class="webex-solveme nospaces" size="2" data-answer="[&quot;21&quot;]">
</li>
</ul>
<p>Finally, now make a dataset <code>no_exam</code> that contains students have have a grade for the essay but not the exam</p>
<div class="cell" data-layout-align="center" data-webex.hide="true">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>no_exam <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(essay_grades, exam_grades, <span class="at">by =</span> <span class="st">"id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<ul>
<li>How many students have a grade for the exam but not the essay? <input class="webex-solveme nospaces" size="2" data-answer="[&quot;15&quot;]">
</li>
</ul></section><section id="share-on-teams" class="level3" data-number="7.10.5"><h3 data-number="7.10.5" class="anchored" data-anchor-id="share-on-teams">
<span class="header-section-number">7.10.5</span> Share on Teams</h3>
<p>Once you’re done, share your knitted html file and the Rmd file for the exercises on Teams in the Week 07 channel.</p>
</section></section><section id="sec-glossary-joins" class="level2" data-number="7.11"><h2 data-number="7.11" class="anchored" data-anchor-id="sec-glossary-joins">
<span class="header-section-number">7.11</span> Glossary</h2>
<div class="cell" data-layout-align="center">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: left;">definition</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><a href="https://psyteachr.github.io/glossary/b#base-r" class="glossary" target="_blank">base-r</a></td>
<td style="text-align: left;">The set of R functions that come with a basic installation of R, before you add external packages.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="https://psyteachr.github.io/glossary/b#binding-joins" class="glossary" target="_blank">binding-joins</a></td>
<td style="text-align: left;">Joins that bind one table to another by adding their rows or columns together.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="https://psyteachr.github.io/glossary/c#character" class="glossary" target="_blank">character</a></td>
<td style="text-align: left;">A data type representing strings of text.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="https://psyteachr.github.io/glossary/f#factor" class="glossary" target="_blank">factor</a></td>
<td style="text-align: left;">A data type where a specific set of values are stored with labels; An explanatory variable manipulated by the experimenter</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="https://psyteachr.github.io/glossary/f#filtering-joins" class="glossary" target="_blank">filtering-joins</a></td>
<td style="text-align: left;">Joins that act like the dplyr::filter() function in that they remove rows from the data in one table based on the values in another table.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="https://psyteachr.github.io/glossary/i#iteration" class="glossary" target="_blank">iteration</a></td>
<td style="text-align: left;">Repeating a process or function</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="https://psyteachr.github.io/glossary/m#mutating-joins" class="glossary" target="_blank">mutating-joins</a></td>
<td style="text-align: left;">Joins that act like the dplyr::mutate() function in that they add new columns to one table based on values in another table.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><a href="https://psyteachr.github.io/glossary/n#numeric" class="glossary" target="_blank">numeric</a></td>
<td style="text-align: left;">A data type representing a real decimal number or integer.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><a href="https://psyteachr.github.io/glossary/s#set-operations" class="glossary" target="_blank">set-operations</a></td>
<td style="text-align: left;">Functions that compare two tables and return rows that match (intersect), are in either table (union), or are in one table but not the other (setdiff).</td>
</tr>
</tbody>
</table>
</div>
</section><section id="sec-resources-joins" class="level2" data-number="7.12"><h2 data-number="7.12" class="anchored" data-anchor-id="sec-resources-joins">
<span class="header-section-number">7.12</span> Further resources</h2>
<ul>
<li><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-transformation.pdf">Data transformation cheatsheet</a></li>
<li>
<a href="https://r4ds.hadley.nz/joins">Chapter 19: Joins</a> in <em>R for Data Science</em>
</li>
<li>
<a href="https://r4ds.hadley.nz/iteration">Chapter 26: Iteration</a> in <em>R for Data Science</em>.</li>
<li><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/purrr.pdf">purrr cheatsheet</a></li>
</ul>


</section></main><!-- /main --><script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script><script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;

    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    $(solveme[i]).after(" <span class='webex-icon'></span>");
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    $(selects[i]).after(" <span class='webex-icon'></span>");
  }

  update_total_correct();
}

</script><script>
$( document ).ready(function() {
  var cite = ' ';
  var psyteachr = ' <a href="https://psyteachr.github.io/"><img src="images/logos/psyteachr_logo.png" style="height: 31px; color: white;" alt="psyTeachR: Reproducible Research" /></a>';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    psyteachr + license + cite
  );

  function move_sidebar() {
    var w = window.innerWidth;
    if (w < 992) {
      $("#toc").appendTo($("#main-nav"));
    } else {
      $("#toc").appendTo($("div.sidebar-chapter"));
    }
  }
  move_sidebar();
  window.onresize = move_sidebar;
});
</script><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./06-ai.html" class="pagination-link" aria-label="Coding with AI">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Coding with AI</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./08-tidy.html" class="pagination-link" aria-label="Data Tidying">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data Tidying</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>CC-BY 2024, psyTeachR</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/psyteachr/ads-v3/edit/master/07-joins.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/psyteachr/ads-v3/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/psyteachr/ads-v3/blob/master/07-joins.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/psyteachr/ads-v3">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/psyteachr">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://doi.org/10.5281/zenodo.6365077">
      <i class="bi bi-https://zenodo.org/badge/DOI/10.5281/zenodo.6365077.svg" role="img">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>